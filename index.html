<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <button id="reloadButton">reload comments</button>
        <div id="comments"></div>
    </div>
    <div>
        <textarea id="commentText" placeholder="write a comment"></textarea>
    </div>
    <button id="postButton">post</button>
</body>
</html>
<style>
    #comments {
        margin: 5px;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
    }

    .comment {
        margin: 5px;
        padding: 5px;
        border-radius: 5px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        background-color: antiquewhite;
    }

    button, #comments {
        min-height: 2rem;
    }

    div, body{
        display: flex;
        flex-direction: column;
    }
</style>
<script>
    const baseURL = "https://us-central1-alien-scope-393620.cloudfunctions.net"
    
    document.getElementById("postButton").onclick = postComment
    document.getElementById("reloadButton").onclick = reloadComments

    reloadComments()

    async function reloadComments() {
        const commentsElmnt = document.getElementById("comments")
        commentsElmnt.innerHTML = ""
        const comments = await getComments()
        for (const comment of comments) {
            const commentDiv = document.createElement("div")
            commentDiv.className = "comment"
            commentDiv.innerText = comment
            commentsElmnt.append(commentDiv)
        }
    }

    async function getComments() {
        const url = `${baseURL}/get-comments`
        const headers = {
            method: "GET",
        }

        const response = await fetch(url, headers);
        const responseData = await response.json()
        console.log(responseData.Comments)
        return responseData.Comments
    }

    async function postComment() {
        const commentBox = document.getElementById("commentText")
        const commentText = commentBox.value
        const requestBody = {
            text: commentText
        }
        const url = `${baseURL}/post-comment`
        const headers = {
            method: "POST",
            body: JSON.stringify(requestBody)
        }

        try {
            const response = await fetch(url, headers);
            console.log(response);
            clearCommentBox()
            reloadComments()
        } catch (error) {
            console.error(`Error: ${error}`);
        }

        function clearCommentBox() {
            commentBox.value = ""
        }
    }

    

    function greet() {
        const url = `${baseURL}/greet`
        const headers = {
            method: "GET",
        }

        fetch(url, headers)
    }
</script>